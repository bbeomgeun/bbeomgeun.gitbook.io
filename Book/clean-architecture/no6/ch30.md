# 30장 데이터베이스는 세부사항이다
> 아키텍처 관점에서 볼 때 데이터베이스는 엔티티가 아니다. 즉, DB는 세부사항이라서 아키텍처의 구성요소 수준으로 끌어올릴 수 없다.
> 어플리케이션 내부의 데이터 구조는 시스템 아키텍처에서 대단히 중요하지만, 데이터베이스 자체는 일개 소프트웨어일 뿐이다.
> 데이터베이스는 데이터에 접근할 방법을 제공하는 유틸리티로, 저수준의 세부사항일 뿐이라서 아키텍처와는 관련이 없다.

## 관계형 데이터베이스
- 관계형 데이터베이스의 기술이 얼마나 뛰어나든, 유용하든, 결국은 그저 기술일 뿐이다.
- 이는 관계형 데이터베이스가 세부사항임을 뜻한다.
  - 데이터가 테이블 구조를 가진다는 사실은 오직 아키텍처의 외부 원에 위치한 최하위 수준의 유틸리티 함수만 알아야 한다.
- 데이터 접근 프레임워크가 테이블과 행이 객체 형태로 시스템에 돌아다니게 하는데, 아키텍처적으로 잘못된 설계다.
  - 이렇게 하면 유스케이스, 업무 규칙, 심지어는 UI 조차도 관계형 데이터 구조에 결합되어 버린다.

## 데이터베이스 시스템은 왜 이렇게 널리 사용되는가?
- 바로 디스크때문이다.
- 디스크가 업데이트되지만, 느리다는 특성은 변함이 없었다.
  - 디스크는 십여 개의 플래터로, 플래터는 수백 개의 트랙으로, 원형 트랙이 섹터로 분할된다.
    - 디스크에서 특정 바이트를 읽으려면, 먼저 헤드를 적절한 트랙으로 옮기고, 디스크가 돌면서 헤드 위치에 적절한 섹터가 올 때까지 기다린 후, 해당 섹터에서 모두 RAM으로 읽어 들여야 한다. 그 이후, 필요한 바이트를 가져왔다.
- 디스크가 아니었다면 훨씬 빨랐을 것이다.
  - 이러한 필연적인 시간 지연때문에, 색인, 캐시, 쿼리 계획 최적화가 필요해졌다.
  - 그러다보니 데이터 접근 및 관리 시스템이 필요했고, 파일 시스템과 관계형 데이터베이스 관리 시스템이라는 두 가지 유형의 시스템으로 분리되었다.
- 파일 시스템은
  - 일련의 문서를 이름을 기준으로 저장하거나, 조회할 때는 잘 동작하지만 내용을 기준으로 검색 시 크게 도움되지 않는다.
- 데이터베이스 시스템은
  - 내용 기반으로 검색 시 레코드를 자연스럽고 편리하게 찾는 방법을 제공한다.
  - 하지만 정형화되지 않은 문서를 저장하고 검색하는 데는 대체로 부적합하다.
- 따라서 각 시스템에 특화된 방식

## 디스크가 없다면 어떻게 될까?
- 디스크는 이제 소멸 중인 부품이다. 머지않아 디스크는 CD가 지나온 길을 걸을 것이고, RAM으로 대체되고 있다.
- 디스크가 모두 사라지고, RAM에 저장된다면 데이터를 어떻게 체계화할 것인가?
  - 데이터를 테이블 구조로 만들어서 SQL을 이용해 접근할 것인가?
  - 파일 구조로 만들어 디렉토리를 통해 접근할 것인가?
- 모두 아니다. 데이터들을 수많은 자료 구조로 체계화할 것이며, 데이터에 접근할 때는 포인터나 참조를 사용할 것이다.
- 사실, 우리는 지금도 데이터를 DB나 파일 시스템에서 읽어와도 RAM으로 읽은 후에 다루기 편한 형태의 자료 구조에 저장한다.

## 세부사항
- 데이터베이스가 세부사항이라고 말하는 이유는 바로 이러한 현실 때문이다.
- 데이터베이스는 그저 메커니즘에 불과하고, 디스크 표면과 RAM 사이에서 데이터를 이리저리 옮길 때 사용할 뿐이다.
  - 실제로 데이터베이스는 비트를 담는 거대한 그릇이며, 데이터를 장기적으로 저장하는 공간에 지나지 않는다.
- 따라서 아키텍처 관점에서 본다면 데이터가 어떤 형태인지는 절대로 신경 써서는 안 된다.
  - 디스크 자체가 존재한다는 사실조차도 인식해서는 안 된다.

## 하지만 성능은?
- 성능은 분명히 아키텍처적인 관심사이다.
  - 하지만 데이터 저장소의 측면에서 성능은 완전히 캡슐화하여 업무 규칙과는 분리할 수 있는 관심사이다.
  - 데이터를 빠르게 넣고 뺄 수 있어야 하는 건 맞지만, 이는 저수준의 관심사이다.

## 개인적인 일화
- 데이터베이스를 사용할 이유가 없었지만, 고객이 전적으로 원했던 일화

## 결론
- 체계화된 데이터 구조와 데이터 모델은 아키텍처적으로 중요하다.
- 반면, 그저 데이터를 디스크 표면에서 이리저리 옮길 뿐인 기술과 시스템은 아키텍처적으로 중요치 않다.
  - 데이터를 테이블 구조로 만들고 SQL로만 접근하도록 하는 관계형 데이터베이스 시스템은 후자와 가깝다.
- 데이터는 중요하다.
- 데이터베이스는 세부사항이다.
> 어떤 data source를 사용하는지는 중요한 관심사가 아니다. 추상화시키고 언제든 변경될 수 있게끔 관리한다.