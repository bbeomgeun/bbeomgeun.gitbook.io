# 28장 테스트 경계
- 테스트 역시 시스템의 일부이며 아키텍처에도 관여한다.

## 시스템 컴포넌트인 테스트
- 테스트는 태생적으로 의존성 규칙을 따른다. 테스트는 세부적이며 구체적인 것으로, 의존성은 항상 테스트 대상이 되는 코드를 향한다.
- 시스템 내부의 어떤 것도 테스트에는 의존하지 않으며, 테스트는 시스템의 컴포넌트를 향해, 항상 원의 안쪽으로 의존한다.

## 테스트를 고려한 설계
- 테스트가 지닌 극단적인 고립성이 테스트는 대체로 배포하지 않는다는 사실과 어우러지며, 개발자는 종종 테스트가 시스템의 설계 범위 밖에 있다고 여긴다.
- 이 관점은 매우 치명적이다.
  - 테스트가 시스템의 설계와 잘 통합되지 않으면, 테스트는 깨지기 쉬워지고 시스템은 뻣뻣해져서 변경하기가 어려워진다.
- 문제는 결합이다. 시스템에 강결합된 테스트라면 변경 시 수많은 테스트 역시 깨질 수 있다.
  - 깨지기 쉬운 테스트 문제 (Fragile Tests Problem)으로 알려져 있다.
- 간단한 변경이 대량의 테스트 실패로 이어진다면 -> 개발자는 그러한 변경을 하지 않으려 들 것이고 시스템이 뻣뻣해진다는 부작용이 생긴다.
  - 이러한 문제를 해결하기 위해 테스트를 고려해서 설계해야 한다.
  - 설계 시 불변의 규칙 : 변동성이 있는 것에 의존하지 말라.

## 테스트 API
- 위 목표를 달성하려면 테스트가 모든 업무 규칙을 검증하는 데 사용할 수 있도록 특화된 API를 만들면 된다.
- 테스트 API가
  - 보안 제약사항을 무시할 수 있으며
  - DB와 같은 값비싼 자원은 건너뛰고
  - 시스템을 테스트 가능한 특정 상태로 강제하는 강력한 힘을 지녀야만 한다.
- 테스트를 어플리케이션 구조로부터 결합을 분리하는 게 목표이다.

### 구조적 결합
- 모든 상용 클래스에 테스트 클래스가 각각 존재하고, 또 모든 상용 메서드에 테스트 메서드 집합이 각각 존재하는 테스트 스위트가 있따고 가정해보자.
  - 이러한 테스트 스위트는 어플리케이션 구조에 강결합되어 있다.
- 결국 상용 클래스나 메서드가 변경되면 딸려 있는 다수의 테스트가 변경되어야 한다.
  - 결과적으로 테스트는 깨지기 쉬워지고, 상용 코드가 뻣뻣해진다.
- 테스트 API를 통해 어플리케이션의 구조를 테스트로부터 숨길 수 있다.
  - 상용 코드를 리팩토링을 하거나 진화시켜도 테스트는 영향을 받지 않는다.
  - 테스트를 리팩터링하거나 진화시킬 때도 상용 코드에는 전혀 영향을 주지 않는다.
- 이와 같이 따로따로 발전할 수 있는 구조가 되지 않고 구조적 결합이 강하면 필수적인 진화 과정을 방해하고, 상용 코드의 범용성과 유연성이 충분히 좋아지지 못하게 막는다.

### 보안
- 테스트 API를 사용 시 운영에 배포하면 위험에 처할 수 있다.
- 위험한 부분의 구현부는 독립적인 배포가 가능한 컴포넌트로 분리해야 한다.

## 결론
- 테스트는 시스템의 일부이다.
- 테스트에서 기대하는 안정성과 회귀의 이점을 얻기 위해선 테스트는 잘 설계가 되어야 한다.
- 테스트를 시스템의 일부로 설계하지 않는다면 테스트는 깨지기 쉽고 유지보수하기 어려워지는 경향이 있다.
- 테스트의 유지보수가 힘들어지면 결국 버려지는 최후를 맡게 된다.