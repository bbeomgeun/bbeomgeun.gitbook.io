# 23장 프레젠터와 험블 객체

## 험블 객체 패턴
- 험블 객체 패턴은 디자인 패턴으로, 테스트하기 어려운 행위와 테스트하기 쉬운 행위를 분리함으로써 테스트 용이성을 높히는 이점을 갖고 있다.
- 행위들을 두 개의 모듈 또는 클래스로 나누는데, 이 모듈 중 하나가 험블이다.
- 가장 기본적인 본질을 남기고, 테스트하기 어려운 행위를 모두 험블 객체로 옮긴다.
> 22장에서 언급된 프레젠터는 험블 객체 패턴을 따른 형태로, 테스트하기 어려운 뷰와 행위를 테스트할 수 있는 프레젠터로 나눴다.

## 프레젠터와 뷰
- 뷰는 험블 객체이고 테스트하기 어렵다.
- 프레젠터는 테스트하기 쉬운 객체다.
- 뷰는 단지 뷰 모델의 데이터를 화면으로 로드할 뿐이며, 이 외에 뷰가 맡은 역할은 전혀 없다.

## 테스트와 아키텍처
- 테스트 용이성은 좋은 아키텍처가 지녀야 할 속성으로 오랫동안 알려져 왔다.
- 험블 객체 패턴이 좋은 예로, 테스트하기 쉬운 부분과 테스트 하기 어려운 부분으로 분리하면 아키텍처 경계가 정의되기 때문이다.

## 데이터베이스 게이트웨이
- 유스케이스 인터랙터와 데이터베이스 사이에는 데이터베이스 게이트웨이가 위치한다.
- 이 게이트웨이는 다형적 인터페이스로, 어플리케이션이 데이터베이스에 수행하는 모든 메서드를 포함한다.
  - 유스케이스 계층은 SQL을 허용하지 않는다. 따라서 해당 계층은 게이트웨이 인터페이스의 메서드를 호출할 뿐이다.
  - 그리고 인터페이스의 구현체는 데이터베이스 계층에 위치한다.
  - 해당 구현체에서 직접 SQL을 사용하거나 데이터에 접근한다.
- 이와 달리, 인터렉터는 어플리케이션에 특화된 업무 규칙을 캡슐화하기 때문에 험블 객체가 아니다. 따라서 테스트 시 게이트웨이는 mocking할 수 있기에 테스트가 쉬워진다.

## 데이터 매퍼
- hibernate와 같은 ORM은 어느 게층일까?
- 객체는 데이터 구조가 아닌 것이, 데이터는 모두 private으로 접근이 불가능하고, 사용자는 객체에서 public 메서드만 호출 가능하다.
  - 따라서 사용자 입장에서는 단순 오퍼레이션 집합이다.
  - 그와 달리, 데이터 구조는 함축된 행위를 가지지 않는 public 데이터 변수의 집합이다. 
- 따라서 ORM보다는 차라리 데이터 매퍼가 더 나아 보이는데, RDB 테이블에서 가져온 데이터를 데이터 구조에 맞게 담아주기 때문이다.
- 이러한 ORM 시스템은 데이터베이스 계층이다. 게이트웨이 인터페이스와 데이터베이스 사이에서 일종의 또 다른 험블 객체 경계를 형성한다.

## 서비스 리스너
- 어플리케이션이 다른 서비스와 반드시 통신한다고 하면, 험블 객체 패턴을 발견할 수 있다.

## 결론
- 각 아키텍처 경계마다 험블 객체 패턴을 발견할 수 있다.
- 경계를 넘나드는 통신은 거의 모두 간단한 데이터 구조를 수반할 때가 많고, 대개 그 경계는 테스트하기 어려운 무언가와 테스트하기 쉬운 무언가로 분리될 것이다.
- 그리고 해당 경계에서 험블 객체 패턴을 사용하면 전체 시스템의 테스트 용이성을 높힐 수 있다.


> 경계마다 숨어 잇는 험블 객체 패턴을 찾을 수 있는데, 테스트하기 어려운 무언가와 테스트하기 쉬운 무언가로 분리한다면 시스템의 테스트 용이성을 크게 높일 수 있다.